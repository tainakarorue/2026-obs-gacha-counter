# ガチャカウンター 作業進捗

> 最終更新: 2026-02-13

---

## ファイル構成

```
ガチャカウンター/
├── docs/
│   ├── 要件定義書.md        ← 機能要件・データ構造・処理フローの定義
│   ├── 使い方マニュアル.md   ← OBS設定・操作方法の説明
│   └── 作業進捗.md          ← 本ファイル
├── index.html               ← メインHTML
├── css/
│   └── style.css            ← スタイルシート
└── js/
    └── app.js               ← アプリケーションロジック
```

---

## 完了済みの作業

### 1. 初期実装 (完了)

- [x] 要件定義書の作成
- [x] HTML / CSS / JS の3ファイル構成で実装
- [x] カウント機能: 単発(+1)、10連(+10)、10連サービス(+11)
- [x] 天井カウンター (設定可能、デフォルト200回)
- [x] 獲得履歴の記録・一覧表示
- [x] キーボードショートカット (1, 2, 3, Space, Z, R)
- [x] localStorage による自動保存・復元
- [x] Undo (戻す) 機能
- [x] リセット機能
- [x] カウント変動パルスアニメーション
- [x] 獲得時ゴールド光彩エフェクト
- [x] OBS 用の透明背景・ダーク系テーマ

### 2. フィードバック対応 (完了)

- [x] 獲得履歴の表示順を変更: 個別回数をメイン、累計を括弧表示に
  - 変更前: `1体目  120回目  (75回)`
  - 変更後: `1体目  75回  (累計120回目)`
- [x] グレー文字の視認性改善: 全体的に明度を上げた
  - ラベル類: `#8890aa` → `#b0b8d0`
  - 補助テキスト: `#667088` → `#98a0b8`
  - ショートカット説明: `#555566` → `#8890a8`
- [x] キャラクター名入力欄をタイトル部分に追加
  - `contenteditable` 方式で実装 (OBS IME対策)
  - localStorage に自動保存・復元
  - リセット時にクリア
- [x] メインカウンターとサブカウンターを入れ替え
  - メイン (大): 現在の回数 (前回獲得から)
  - サブ (水色): 総回数
  - サブ (オレンジ): 天井まで
- [x] リセットのconfirmダイアログをカスタムUIに変更
  - OBS ブラウザソースで `confirm()` が動作しない問題を修正
  - 画面内にオーバーレイ式の確認ダイアログを実装
- [x] 使い方マニュアルの作成
  - 方法A: ブラウザソースでの読み込み手順
  - 方法B: ウィンドウキャプチャでの読み込み手順
  - OBS ブラウザソースのリロード手順を追記

---

## 未対応・次回対応予定の課題

### 優先度: 高

- [ ] **OBS ブラウザソースでの日本語入力 (IME) 問題**
  - OBS の CEF (Chromium Embedded Framework) の制限で IME 切替が不可
  - `<input>` → `contenteditable` に変更済みだが、IME 自体が使えない
  - **対応案:** URLパラメータでキャラ名を設定できるようにする
    - OBS 側: ローカルファイルのチェックを外し `file:///パス/index.html?name=キャラ名` で指定
    - JS 側: `URLSearchParams` で読み取り、state に反映する処理を追加
  - **対応案2:** OBS「カスタムCSS」欄を使って `--char-name` CSS変数で渡す方法
  - **実装途中:** `js/app.js` の `load()` 関数にURLパラメータ読み取りを追加する作業に着手直前で中断

### 優先度: 中

- [ ] 要件定義書の更新 (実装済みの変更を反映)
  - 表示順序の変更 (現在回数がメイン)
  - キャラクター名入力欄の追加
  - カスタム確認ダイアログの仕様

### 優先度: 低 (ユーザーフィードバック次第)

- [ ] デザイン調整 (フォント・色・サイズなど)
- [ ] その他 OBS 運用時の不具合対応

---

## 技術メモ

### OBS ブラウザソースの制限事項

| 制限 | 対応状況 |
|------|---------|
| `confirm()` / `alert()` が動作しない | カスタムUIで対応済み |
| IME (日本語入力) が使えない | URLパラメータ対応で解決予定 |
| localStorage は OBS とブラウザで共有されない | マニュアルに記載済み |

### 現在のデータ構造 (localStorage)

```json
{
  "totalCount": 150,
  "pityLimit": 200,
  "charName": "キャラクター名",
  "history": [
    { "id": 1, "totalAtGet": 45,  "pullsSinceLast": 45 },
    { "id": 2, "totalAtGet": 120, "pullsSinceLast": 75 }
  ],
  "undoStack": [
    { "type": "pull", "amount": 10, "totalBefore": 140 }
  ]
}
```

### キーボードショートカット一覧

| キー | 操作 | 実装箇所 |
|------|------|---------|
| `1` | +1 | `js/app.js` L280-282 |
| `2` | +10 | `js/app.js` L284-286 |
| `3` | +11 | `js/app.js` L288-290 |
| `Space` | 獲得記録 | `js/app.js` L292-294 |
| `Z` | Undo | `js/app.js` L296-299 |
| `R` | リセット確認表示 | `js/app.js` L301-304 |
